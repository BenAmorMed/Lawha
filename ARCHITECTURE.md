# ğŸ—ï¸ Complete Architecture Documentation

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PRESENTATION LAYER                         â”‚
â”‚                   Next.js 14 + React 18 + Konva.js              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Gallery    â”‚   Editor     â”‚  Checkout    â”‚  Dashboard   â”‚  â”‚
â”‚  â”‚   (Browse)   â”‚  (Design)    â”‚  (Payment)   â”‚  (Account)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Zustand State Management                   â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚ Editor Store â”‚  â”‚ Auth Store   â”‚  â”‚ Order Store  â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              API Client (Axios)                         â”‚    â”‚
â”‚  â”‚  baseURL: http://localhost:4000/api/v1                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    REST API (JSON)
                    Multipart (Files)
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    APPLICATION LAYER                            â”‚
â”‚                   NestJS 10 + Express.js                        â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                   HTTP Listeners                        â”‚    â”‚
â”‚  â”‚  Port 4000 / /api/v1/                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Route Controllers (6 modules)              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚   Auth   â”‚ â”‚ Products   â”‚ â”‚ Templatesâ”‚ â”‚ Images â”‚  â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚    â”‚
â”‚  â”‚  â”‚  Orders  â”‚ â”‚   Jobs     â”‚ â”‚ (more)   â”‚ â”‚        â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚            Business Logic (Services)                    â”‚    â”‚
â”‚  â”‚  - Authentication & JWT                                â”‚    â”‚
â”‚  â”‚  - Product catalog operations                          â”‚    â”‚
â”‚  â”‚  - Order processing                                    â”‚    â”‚
â”‚  â”‚  - Image validation & storage                          â”‚    â”‚
â”‚  â”‚  - Job queuing                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           Database Access (TypeORM)                     â”‚    â”‚
â”‚  â”‚  - Entity definitions                                  â”‚    â”‚
â”‚  â”‚  - Query builders                                      â”‚    â”‚
â”‚  â”‚  - Migrations                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                      â”‚                       â”‚
       â”‚                      â”‚                       â”‚
   TCP 5432                TCP 6379               HTTP 9000
       â”‚                      â”‚                       â”‚
       â”‚                      â”‚                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚            â”‚        â”‚               â”‚        â”‚             â”‚
â”‚  PostgreSQLâ”‚        â”‚    Redis      â”‚        â”‚   MinIO     â”‚
â”‚     16     â”‚        â”‚      7        â”‚        â”‚ (S3 API)    â”‚
â”‚            â”‚        â”‚               â”‚        â”‚             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Tables â”‚ â”‚        â”‚ â”‚  Queues  â”‚  â”‚        â”‚ â”‚ Buckets â”‚ â”‚
â”‚ â”‚ Indexesâ”‚ â”‚        â”‚ â”‚  Cache   â”‚  â”‚        â”‚ â”‚ Objects â”‚ â”‚
â”‚ â”‚ Triggersâ”‚ â”‚        â”‚ â”‚          â”‚  â”‚        â”‚ â”‚         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚            â”‚        â”‚               â”‚        â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                      â–²                       â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                       â”‚
                  â”‚  Worker Pool (Node.js)â”‚
             â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
             â”‚    Print Worker Process          â”‚
             â”‚                                  â”‚
             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
             â”‚  â”‚ Queue Listener (Bull)     â”‚   â”‚
             â”‚  â”‚ - Listen for print jobs   â”‚   â”‚
             â”‚  â”‚ - Dequeue & process       â”‚   â”‚
             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
             â”‚                                  â”‚
             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
             â”‚  â”‚ Rendering Engine          â”‚   â”‚
             â”‚  â”‚ - node-canvas (HTML2Canvas)   â”‚
             â”‚  â”‚ - Sharp (Image processing) â”‚   â”‚
             â”‚  â”‚ - PDFKit (PDF generation) â”‚   â”‚
             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
             â”‚                                  â”‚
             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
             â”‚  â”‚ Output                    â”‚   â”‚
             â”‚  â”‚ - PDF (300 DPI)           â”‚   â”‚
             â”‚  â”‚ - PNG (high-res)          â”‚   â”‚
             â”‚  â”‚ â†’ Upload to MinIO         â”‚   â”‚
             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Models (Simplified ERD)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           USERS                                   â”‚
â”‚  id (PK) | email | password_hash | full_name | role | timestamps â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â”‚ has many
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ORDERS                                   â”‚
â”‚  id | user_id | status | total | shipping | payment_ref | ...   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ contains
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ORDER_ITEMS                                  â”‚
â”‚  id | order_id | product_id | template_id | design_json | price   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚          â”‚                â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
      â”‚ PRODUCTS â”‚   â”‚ TEMPLATES â”‚   â”‚PRINT_JOBS â”‚
      â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ has many                  â”‚
    â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚PRODUCT_SIZES â”‚         â”‚ FRAME_OPTIONS â”‚
â”‚              â”‚         â”‚               â”‚
â”‚ label        â”‚         â”‚ label         â”‚
â”‚ width_cm     â”‚         â”‚ color_hex     â”‚
â”‚ height_cm    â”‚         â”‚ material      â”‚
â”‚ price_delta  â”‚         â”‚ price_delta   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         UPLOADED_IMAGES (User files)                â”‚
â”‚ id | user_id | original_url | thumb_url | quality   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## API Endpoints Structure

### Authentication (`/auth`)
```
POST   /register         - Create user account
POST   /login            - Get JWT token
POST   /refresh          - Refresh token
GET    /me               - Current user (protected)
POST   /logout           - Logout
```

### Products (`/products`)
```
GET    /                 - All products with full details
GET    /:id              - Single product with sizes & frames
GET    /:id/sizes        - Product size variants
GET    /:id/frames       - Frame options for product
```

### Templates (`/templates`)
```
GET    /                 - All templates
GET    /:id              - Template definition with slots
GET    /category/:name   - Templates by category (couple, family, etc)
```

### Images (`/images`)
```
POST   /upload           - Upload image (multipart)
GET    /                 - User's uploaded images
GET    /:id              - Single image metadata
DELETE /:id              - Delete image
GET    /:id/signed-url   - Get temporary S3 signed URL
```

### Orders (`/orders`)
```
POST   /                 - Create new order
GET    /                 - User's orders
GET    /:id              - Order details
PUT    /:id              - Update order
POST   /:id/items        - Add item to order
PUT    /:id/items/:iid   - Update order item
DELETE /:id/items/:iid   - Remove item from order
POST   /:id/checkout     - Process payment
```

### Print Jobs (`/jobs`) - Admin/Internal
```
GET    /                 - All print jobs (admin)
GET    /:id              - Job status
POST   /:id/retry        - Retry failed job
DELETE /:id              - Cancel job
```

---

## Authentication Flow

```
USER                        FRONTEND                      BACKEND
â”‚                              â”‚                             â”‚
â”œâ”€ Click Login â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚                             â”‚
â”‚                              â”‚                             â”‚
â”‚                              â”œâ”€ POST /auth/login â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚
â”‚                              â”‚ {email, password}           â”‚
â”‚                              â”‚                             â”‚
â”‚                              â”‚         â—„â”€â”€â”€â”€ JWT Token â”€â”€â”€â”€â”¤
â”‚                              â”‚                             â”‚
â”‚                    Store JWT in localStorage               â”‚
â”‚                              â”‚                             â”‚
â”‚ Browse Products â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚                             â”‚
â”‚                              â”œâ”€ GET /products â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚
â”‚                              â”‚ Header: Authorization: Bearer JWT
â”‚                              â”‚                             â”‚
â”‚                              â”‚  Verify JWT âœ“               â”‚
â”‚                              â”‚  Return products            â”‚
â”‚                    Store in Zustand                        â”‚
â”‚                              â”‚                             â”‚
```

---

## Data Flow: Design to Print

```
DESIGNER                    EDITOR              API            WORKER
   â”‚                          â”‚                  â”‚                â”‚
   â”œâ”€ Upload Photo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                  â”‚                â”‚
   â”‚                          â”‚                  â”‚                â”‚
   â”‚  Browse Templates â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚
   â”‚                          â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚
   â”‚                          â”‚ Return template â”‚                â”‚
   â”‚  Choose Size/Frame â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
   â”‚                          â”‚ Store in        â”‚                â”‚
   â”‚  Edit Text â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Zustand         â”‚                â”‚
   â”‚                          â”‚ Create Design   â”‚                â”‚
   â”‚  Real-time Preview â—„â”€â”€â”€â”€â”€â”¤ JSON            â”‚                â”‚
   â”‚                          â”‚                  â”‚                â”‚
   â”‚  Ready to Order â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                â”‚
   â”‚                          â”‚              â”‚  â”‚                â”‚
   â”‚                          â”œâ”€ POST /ordersâ”€â”€â”€â”€â–ºâ”‚               â”‚
   â”‚                          â”‚ design_json,     â”‚               â”‚
   â”‚                          â”‚ product_id,      â”‚               â”‚
   â”‚                          â”‚ size_id,         â”‚               â”‚
   â”‚                          â”‚ frame_id         â”‚               â”‚
   â”‚                          â”‚                  â”‚               â”‚
   â”‚                          â”‚â—„â”€â”€â”€ Order Createdâ”€â”€â”€â”€           â”‚
   â”‚                          â”‚                  â”‚               â”‚
   â”‚  Pay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚               â”‚
   â”‚                          â”‚              â”‚  â”‚               â”‚
   â”‚                          â”œâ”€ POST /orders/checkoutâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                          â”‚              â”‚  â”‚  Create       â”‚
   â”‚                          â”‚              â”‚  â”‚  print_job    â”‚
   â”‚                          â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Enqueue      â”‚
   â”‚                          â”‚ Order Complete   â”‚               â”‚
   â”‚                          â”‚                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                          â”‚                  â”‚  â”‚ Listen    â”‚
   â”‚ Confirm â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚  â”‚ to queue  â”‚
   â”‚                          â”‚                  â”‚  â”‚           â”‚
   â”‚                          â”‚                  â”‚  â”œâ”€ Render canvas
   â”‚                          â”‚                  â”‚  â”‚   at 300 DPI
   â”‚                          â”‚                  â”‚  â”‚           â”‚
   â”‚                          â”‚                  â”‚  â”œâ”€ Generate PDF
   â”‚                          â”‚                  â”‚  â”‚           â”‚
   â”‚                          â”‚                  â”‚  â”œâ”€ Upload to
   â”‚                          â”‚                  â”‚  â”‚   MinIO
   â”‚                          â”‚                  â”‚  â”‚           â”‚
   â”‚                          â”‚                  â”‚  â”œâ”€ Update DB
   â”‚                          â”‚                  â”‚  â”‚   print_file_url
   â”‚ ğŸ‰ Print Ready!         â”‚                  â”‚  â”‚           â”‚
   â”‚                          â”‚                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
```

---

## Technology Stack Summary

### Frontend
- **Framework:** Next.js 14 (React 18)
- **UI:** Tailwind CSS
- **Canvas:** Konva.js
- **State:** Zustand
- **HTTP:** Axios
- **Language:** TypeScript

### Backend
- **Runtime:** Node.js 20
- **Framework:** NestJS 10
- **Database:** PostgreSQL 16 + TypeORM
- **Cache/Queue:** Redis 7 + Bull
- **Storage:** MinIO (S3 API)
- **Authentication:** JWT + Passport
- **Language:** TypeScript

### DevOps
- **Containerization:** Docker & Docker Compose
- **Image Processing:** Sharp
- **Canvas Rendering:** node-canvas
- **PDF Generation:** PDFKit
- **Process Manager:** Bull Queue

---

## Database Indexes for Performance

```
CREATE INDEX idx_orders_user        ON orders(user_id);
CREATE INDEX idx_orders_status      ON orders(status);
CREATE INDEX idx_order_items_order  ON order_items(order_id);
CREATE INDEX idx_uploaded_user      ON uploaded_images(user_id);
CREATE INDEX idx_print_jobs_status  ON print_jobs(status);
CREATE INDEX idx_templates_key      ON templates(template_key);
```

---

## Environment Variables

### Backend (.env)
```
DB_HOST=postgres
DB_PORT=5432
DB_USERNAME=canvas_user
DB_PASSWORD=canvas_secret
DB_NAME=canvas_platform

REDIS_HOST=redis
REDIS_PORT=6379

MINIO_ENDPOINT=minio
MINIO_PORT=9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin123

JWT_SECRET=<min 32 chars>
JWT_EXPIRATION=24h

PORT=4000
NODE_ENV=development
```

### Frontend (.env.local)
```
NEXT_PUBLIC_API_URL=http://localhost:4000/api/v1
```

---

**This architecture ensures:**
- âœ… Scalability with microservices-ready design
- âœ… Separation of concerns (frontend/backend/workers)
- âœ… Real-time job processing with Bull queue
- âœ… Secure file handling with MinIO
- âœ… High-performance rendering at 300 DPI
- âœ… Fast frontend with Next.js optimizations
- âœ… Type-safe development with TypeScript
